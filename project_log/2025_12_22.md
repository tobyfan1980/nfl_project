# Project Log - December 22, 2025

## Weather Data Integration

### Major Refactoring of Weather Crawler
- **Complete rewrite of `tools/weather_crawler.py`**:
  - Changed from NOAA NCEI API-based city weather fetcher to a game-specific weather data adder
  - Now reads NFL games CSV files and adds weather temperature and condition columns based on zipcode
  - Supports multiple weather API providers:
    - **Visual Crossing API** (primary, with free tier support)
    - **OpenWeatherMap API** (fallback option)
  - Accepts zipcode, date, and time to fetch historical weather data for each game

### New Features

#### Weather Data Integration Functionality
- `add_weather_to_games()` function:
  - Reads game CSV files with zipcode column
  - Fetches historical weather data for each game based on:
    - Date
    - Time
    - Zipcode (location of the home team's stadium)
  - Adds `temperature` and `condition` columns to the games CSV
  - Includes rate limiting (0.5s delay between requests)
  - Progress tracking and error handling

#### API Provider Support
- **Visual Crossing API** (recommended):
  - Free tier available
  - Supports historical weather data
  - Uses `VISUAL_CROSSING_API_KEY` environment variable
- **OpenWeatherMap API** (fallback):
  - Limited historical data (may require paid subscription)
  - Uses `OPENWEATHER_API_KEY` environment variable

### Zipcode Integration Script
- Created `add_zipcodes.py` utility:
  - Adds zipcode column to NFL games CSV files
  - Maps home team to stadium zipcode using team-zipcode mapping file
  - Determines home team based on '@' symbol in game data
  - Uses `dev_data/nfl_teams_stadium_zip_only_5digit_text.csv` as mapping source

### Data Updates
- **Updated game data files**:
  - `dev_data/2023_games.csv`: Added zipcode and weather columns
  - `dev_data/2024_games.csv`: Added zipcode and weather columns

### Command-Line Usage

#### Adding Zipcodes to Games
```bash
python add_zipcodes.py --games-file dev_data/2024_games.csv
```

#### Adding Weather Data to Games
```bash
# Using Visual Crossing API (default)
python tools/weather_crawler.py --games-file dev_data/2024_games.csv --api visual_crossing

# Using OpenWeatherMap API
python tools/weather_crawler.py --games-file dev_data/2024_games.csv --api openweather
```

### Workflow
1. **Add zipcodes**: Run `add_zipcodes.py` to add zipcode column to games CSV based on home team's stadium
2. **Add weather data**: Run `weather_crawler.py` to fetch and add temperature and condition for each game

### Next Steps
- Analyze impact of weather conditions on game outcomes
- Incorporate weather data into model predictions
- Evaluate correlation between weather and team performance
- Consider additional weather metrics (wind speed, precipitation, etc.)
